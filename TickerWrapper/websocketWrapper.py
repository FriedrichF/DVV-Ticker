import asyncio
import json as JSON

import websockets

matchId = ""


async def hello(websocketServer, path):
    global matchId

    uri = "ws://localhost:8765"
    async with websockets.connect('wss://backend.sams-ticker.de/ASSOCIATION/dvv-main',
                                  origin="https://dvv.sams-ticker.de", max_size=1000000000) as websocket:
        # await websocketServer.send(
        #     '{"matchUuid":"087ec706-993b-47ef-8fde-4d1837a66539","matchSeriesUuid":"7a28fa06-1b83-4b49-a6ed-7061369feedb","finished":false,"finalized":false,"started":true,"teamSides":{"leftTeam":"team2","rightTeam":"team1"},"scoresheetPdfUrl":"https://distributor.sams-score.de/scoresheet/pdf/087ec706-993b-47ef-8fde-4d1837a66539/37.pdf","setPoints":{"team1":0,"team2":0},"matchSets":[{"setScore":{"team1":5,"team2":7},"setNumber":1}],"eventHistory":[{"uuid":"622fbb11-5a30-4e6d-8271-14c79a8891a9","setScore":{"team1":1,"team2":3},"setPoints":{"team1":0,"team2":0},"timestamp":1603387888433,"teamCode":"team2","setNumber":1,"type":"SCORE","streak":3},{"uuid":"16530c43-40b3-4b15-bacc-e888d40b1d55","setScore":{"team1":0,"team2":0},"setPoints":{"team1":0,"team2":0},"timestamp":1603387760906,"lineups":{"team1":{"playerUuids":["97ed07d7-45d6-4c9e-9acd-d56b4d1a2da5","9c212865-d6be-4812-9ad1-aa89c7a57600","44f64974-82ca-4d12-90ed-64668871e5ed","a2600281-7f05-4446-b030-b8d06b32dc87","74bb3f5e-9872-403f-b568-19f9ea1d6093","8e392118-abb9-4df6-9160-90fefca6e0e2"],"defaultLiberoUuid":null},"team2":{"playerUuids":["753b94e6-d7a1-46be-bba5-0d4608e9b5cc","b17fb871-ce41-41d8-afa8-eaee2b86ac3c","e18557ee-d752-4ab9-9b7f-9ee8fcbba621","eb656dd0-d9f9-449c-a435-ee74091373a7","7a43a815-5b42-4a8c-9ea2-868f949f295f","fa793bac-f922-451a-8396-f4e83972cfdb"],"defaultLiberoUuid":null}},"type":"START_MATCH"},{"uuid":"15781b60-ce48-453c-aba3-0fcb6b784d37","setScore":{"team1":0,"team2":0},"setPoints":{"team1":0,"team2":0},"timestamp":1603386147873,"arbitration":{"firstReferee":{"firstName":"Frank","lastName":"Seeburg"},"secondReferee":{"firstName":"Michael","lastName":"Wernitz"},"firstLinesman":null,"secondLinesman":null,"thirdLinesman":null,"fourthLinesman":null,"observer":null,"scorer":{"firstName":"Christine","lastName":"Wallraff"},"scorerAssistant":{"firstName":"Cristina","lastName":"Niedrée"},"supervisor":null},"type":"CONFIRM_ARBITRATION"},{"uuid":"456a87ee-5202-44b8-8fdc-0b510d17841a","setScore":{"team1":0,"team2":0},"setPoints":{"team1":0,"team2":0},"timestamp":1603383883602,"teamCode":"team1","teamSquad":{"players":[{"uuid":"9c212865-d6be-4812-9ad1-aa89c7a57600","firstName":"Felix","lastName":"Alberts","position":null,"jerseyNumber":"12","portraitPhoto":null},{"uuid":"44f64974-82ca-4d12-90ed-64668871e5ed","firstName":"Florian","lastName":"Alberts","position":null,"jerseyNumber":"5","portraitPhoto":null},{"uuid":"8e392118-abb9-4df6-9160-90fefca6e0e2","firstName":"Sebastian","lastName":"Graw","position":null,"jerseyNumber":"4","portraitPhoto":null},{"uuid":"1cb82e39-ffe2-41f4-ac5c-716b16ed599a","firstName":"Pawel Krzysztof","lastName":"Kraut","position":null,"jerseyNumber":"37","portraitPhoto":null},{"uuid":"a2600281-7f05-4446-b030-b8d06b32dc87","firstName":"Lasse","lastName":"König","position":null,"jerseyNumber":"7","portraitPhoto":null},{"uuid":"aab9a78d-1b99-441f-ac4d-a035f1e198f0","firstName":"Johannes","lastName":"Neßelrath","position":null,"jerseyNumber":"10","portraitPhoto":null},{"uuid":"97ed07d7-45d6-4c9e-9acd-d56b4d1a2da5","firstName":"Nikita","lastName":"Nikitin","position":null,"jerseyNumber":"9","portraitPhoto":null},{"uuid":"21cd9327-3f60-4c4f-b925-09f68badaa7e","firstName":"Christian","lastName":"Plinz","position":null,"jerseyNumber":"14","portraitPhoto":null},{"uuid":"68079725-1287-40de-adf5-c256a209af8a","firstName":"Sebastian","lastName":"Spölgen","position":null,"jerseyNumber":"3","portraitPhoto":null},{"uuid":"74bb3f5e-9872-403f-b568-19f9ea1d6093","firstName":"Julian","lastName":"Winterscheidt","position":null,"jerseyNumber":"2","portraitPhoto":null},{"uuid":"f719e95f-53c6-4072-a9d3-b0f71f08e523","firstName":"Markus","lastName":"Becker","jerseyNumber":"6","portraitPhoto":null}],"liberos":[{"uuid":"1cb82e39-ffe2-41f4-ac5c-716b16ed599a","firstName":"Pawel Krzysztof","lastName":"Kraut","position":null,"jerseyNumber":"37","portraitPhoto":null},{"uuid":"21cd9327-3f60-4c4f-b925-09f68badaa7e","firstName":"Christian","lastName":"Plinz","position":null,"jerseyNumber":"14","portraitPhoto":null}],"captain":{"uuid":"a2600281-7f05-4446-b030-b8d06b32dc87","firstName":"Lasse","lastName":"König","position":null,"jerseyNumber":"7","portraitPhoto":null},"officials":[{"uuid":"7c1ef5c2-12ee-4125-9cf3-6cf03160189b","firstName":"Sebastian","lastName":"Graw","function":"TRAINER","portraitPhoto":null}]},"type":"CONFIRM_TEAMSQUAD"},{"uuid":"495d5e5b-3f19-44e3-b199-3952a981d497","setScore":{"team1":0,"team2":0},"setPoints":{"team1":0,"team2":0},"timestamp":1603383217517,"teamCode":"team2","teamSquad":{"players":[{"uuid":"753b94e6-d7a1-46be-bba5-0d4608e9b5cc","firstName":"Marcel","lastName":"Beaufils","position":null,"jerseyNumber":"7","portraitPhoto":null},{"uuid":"f771c66b-4098-4abf-bf78-bf4d8c5dbdf5","firstName":"Michael","lastName":"Blumenthal","position":null,"jerseyNumber":"11","portraitPhoto":null},{"uuid":"eb656dd0-d9f9-449c-a435-ee74091373a7","firstName":"Fabian","lastName":"Bork","position":null,"jerseyNumber":"2","portraitPhoto":null},{"uuid":"3cf5bf5d-707f-4416-94be-12e4bdcad8c9","firstName":"Nils","lastName":"Bork","position":null,"jerseyNumber":"3","portraitPhoto":null},{"uuid":"da6ece4c-a976-4a87-999d-a3fc5883d812","firstName":"Daniel","lastName":"Caceres","position":null,"jerseyNumber":"12","portraitPhoto":null},{"uuid":"597d54ed-379f-49e3-87e3-16f2f5294d56","firstName":"Jens","lastName":"Duncker","position":null,"jerseyNumber":"10","portraitPhoto":null},{"uuid":"e18557ee-d752-4ab9-9b7f-9ee8fcbba621","firstName":"Manuel","lastName":"Gerke","position":null,"jerseyNumber":"15","portraitPhoto":null},{"uuid":"7a43a815-5b42-4a8c-9ea2-868f949f295f","firstName":"Tom","lastName":"Gröning","position":null,"jerseyNumber":"13","portraitPhoto":null},{"uuid":"b17fb871-ce41-41d8-afa8-eaee2b86ac3c","firstName":"Lennart","lastName":"Koch","position":null,"jerseyNumber":"20","portraitPhoto":null},{"uuid":"fa793bac-f922-451a-8396-f4e83972cfdb","firstName":"Simon","lastName":"Pichler","position":null,"jerseyNumber":"1","portraitPhoto":null},{"uuid":"87df5906-19ba-4253-b72a-e343f663553c","firstName":"Marc","lastName":"Weller","position":null,"jerseyNumber":"19","portraitPhoto":null}],"liberos":[{"uuid":"da6ece4c-a976-4a87-999d-a3fc5883d812","firstName":"Daniel","lastName":"Caceres","position":null,"jerseyNumber":"12","portraitPhoto":null}],"captain":{"uuid":"b17fb871-ce41-41d8-afa8-eaee2b86ac3c","firstName":"Lennart","lastName":"Koch","position":null,"jerseyNumber":"20","portraitPhoto":null},"officials":[{"uuid":"47a8d834-ff99-4e7c-a9cb-786fe507c815","firstName":"Marc","lastName":"Weller","function":"TRAINER","portraitPhoto":null}]},"type":"CONFIRM_TEAMSQUAD"},{"type":"INITIALIZE_MATCH","matchConfig":{"setsToWin":3,"maximumSets":5,"alwaysPlayMaximumNumberOfSets":false,"pointsToWinSet":25,"pointsToWinDecidingSet":15,"minimumPointDifference":2,"determineDrawWinnerByBallPoints":false,"singleTeamMvpSubmissionEnabled":false,"mvpSubmissionEnabled":true,"resultSubmissionAvailableForPlayingTeams":false,"maxSetPointsForSpecialResultLoss":3,"maxBallPointsForSpecialResultLoss":75,"drawAllowed":false},"uuid":"b511bb31-7d0b-4dbe-9834-7b90b065eccc","timestamp":1603365571049}],"teamLineups":{"team1":{"playerUuids":["74bb3f5e-9872-403f-b568-19f9ea1d6093","8e392118-abb9-4df6-9160-90fefca6e0e2","97ed07d7-45d6-4c9e-9acd-d56b4d1a2da5","9c212865-d6be-4812-9ad1-aa89c7a57600","44f64974-82ca-4d12-90ed-64668871e5ed","a2600281-7f05-4446-b030-b8d06b32dc87"],"defaultLiberoUuid":null},"team2":{"playerUuids":["7a43a815-5b42-4a8c-9ea2-868f949f295f","fa793bac-f922-451a-8396-f4e83972cfdb","753b94e6-d7a1-46be-bba5-0d4608e9b5cc","b17fb871-ce41-41d8-afa8-eaee2b86ac3c","e18557ee-d752-4ab9-9b7f-9ee8fcbba621","eb656dd0-d9f9-449c-a435-ee74091373a7"],"defaultLiberoUuid":null}},"serving":"team2"}')

        while True:
            message = await websocket.recv()
            messages = JSON.loads(message)
            if messages['type'] == 'MATCH_UPDATE':
                if messages['payload']['matchUuid'] == matchId:
                    await websocketServer.send(JSON.dumps(messages['payload']))


if __name__ == "__main__":
    matchId = input("Match id: ")
    start_server = websockets.serve(hello, port=8765)

    asyncio.get_event_loop().run_until_complete(start_server)
    asyncio.get_event_loop().run_forever()
